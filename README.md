# POP MART åœ¨åº«ãƒã‚§ãƒƒã‚«ãƒ¼

POP MARTã®THE MONSTERSï¼ˆãƒ©ãƒ–ãƒ–ç­‰ï¼‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®åœ¨åº«çŠ¶æ³ã‚’è‡ªå‹•ã§ãƒã‚§ãƒƒã‚¯ã—ã€å…¥è·æ™‚ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## æ©Ÿèƒ½

- 5åˆ†ã”ã¨ã«è‡ªå‹•ãƒã‚§ãƒƒã‚¯
- **æ–°è¦å…¥è·å•†å“ã®ã¿ãƒ¡ãƒ¼ãƒ«é€šçŸ¥**ï¼ˆé‡è¤‡é€šçŸ¥ã‚’é˜²æ­¢ï¼‰
- **å†è²©äºˆå®šå•†å“ã®æ¤œçŸ¥ã¨ãƒ¡ãƒ¼ãƒ«é€šçŸ¥**ï¼ˆupTimeæ¤œçŸ¥æ©Ÿèƒ½ï¼‰
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ä¾‹: "LABUBU", "ãƒ©ãƒ–ãƒ–"ï¼‰
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼ˆå…¨å•†å“ã‚’è‡ªå‹•å–å¾—ï¼‰
- å•†å“ã”ã¨ã®åœ¨åº«çŠ¶æ³è¡¨ç¤ºï¼ˆSKUåˆ¥ï¼‰
- åœ¨åº«å¤‰å‹•ã®è¿½è·¡ï¼ˆå‰å›ã¨ã®å·®åˆ†æ¤œçŸ¥ï¼‰
- **å…¨å•†å“ãƒªã‚¹ãƒˆè¡¨ç¤ºãƒ„ãƒ¼ãƒ«**ï¼ˆ`list_all_products.py`ï¼‰
- **è¦–è¦šçš„ãªHTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**ï¼ˆ`generate_html_report.py`ï¼‰
- GitHub Actions ã§å®Œå…¨ç„¡æ–™é‹ç”¨ï¼ˆpublicãƒªãƒã‚¸ãƒˆãƒªï¼‰

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. GitHubãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ

1. GitHubã«ãƒ­ã‚°ã‚¤ãƒ³
2. æ–°ã—ã„**public**ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆï¼ˆGitHub Actionsç„¡æ–™æ ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼‰
3. ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã®å†…å®¹ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥

```bash
cd popmart-stock-checker
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
git push -u origin main
```

### 2. ãƒ¡ãƒ¼ãƒ«è¨­å®šï¼ˆGmail ã®ä¾‹ï¼‰

#### Gmailã§ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ

1. Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³
2. [ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰](https://myaccount.google.com/apppasswords) ã«ã‚¢ã‚¯ã‚»ã‚¹
3. ã€Œã‚¢ãƒ—ãƒªã‚’é¸æŠã€â†’ã€Œãã®ä»–ï¼ˆã‚«ã‚¹ã‚¿ãƒ åï¼‰ã€â†’ã€Œpopmart-checkerã€
4. ã€Œç”Ÿæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. è¡¨ç¤ºã•ã‚ŒãŸ16æ¡ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼

### 3. GitHub Secretsã®è¨­å®š

ãƒªãƒã‚¸ãƒˆãƒªã® `Settings` â†’ `Secrets and variables` â†’ `Actions` â†’ `New repository secret` ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

#### å¿…é ˆã®Secrets

| Secretå | å€¤ | ä¾‹ |
|---------|-----|-----|
| `SMTP_SERVER` | SMTPã‚µãƒ¼ãƒãƒ¼ | `smtp.gmail.com` |
| `SMTP_PORT` | SMTPãƒãƒ¼ãƒˆ | `587` |
| `SMTP_USERNAME` | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | `your-email@gmail.com` |
| `SMTP_PASSWORD` | ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | `abcd efgh ijkl mnop` |
| `RECIPIENT_EMAIL` | é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | `your-email@gmail.com` |

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®Secrets

| Secretå | å€¤ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|---------|-----|-----|-----|
| `COLLECTION_ID` | ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ID | THE MONSTERSã¯223ã€Disneyã¯241 | `223` |
| `KEYWORD` | ãƒ•ã‚£ãƒ«ã‚¿ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ | å•†å“åã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆä¾‹: `LABUBU`ï¼‰ã€‚è¨­å®šã—ãªã„å ´åˆã¯å…¨å•†å“ã‚’ãƒã‚§ãƒƒã‚¯ | ãªã—ï¼ˆå…¨å•†å“ï¼‰ |
| `DEBUG_MODE` | ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ | `true` ã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ­ã‚°ã®ã¿ï¼‰ | `false` |

### 4. å‹•ä½œç¢ºèª

1. ãƒªãƒã‚¸ãƒˆãƒªã® `Actions` ã‚¿ãƒ–ã‚’é–‹ã
2. `Check POP MART Stock` ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠ
3. `Run workflow` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ‰‹å‹•å®Ÿè¡Œ
4. å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèª

### 5. è‡ªå‹•å®Ÿè¡Œ

è¨­å®šãŒå®Œäº†ã™ã‚‹ã¨ã€5åˆ†ã”ã¨ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
- GitHub Actionsã®ãƒ­ã‚°ã§ãƒã‚§ãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨SKUåˆ¥åœ¨åº«çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™
- **æ–°ã—ãåœ¨åº«ãŒè¿½åŠ ã•ã‚ŒãŸå•†å“ã®ã¿ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™**
- **å†è²©äºˆå®šå•†å“ãŒæ¤œçŸ¥ã•ã‚ŒãŸå ´åˆã‚‚ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™**
- æ—¢ã«é€šçŸ¥æ¸ˆã¿ã®å•†å“ã¯2å›ç›®ä»¥é™ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™ï¼ˆé‡è¤‡é€šçŸ¥é˜²æ­¢ï¼‰

#### é€šçŸ¥ãƒ­ã‚¸ãƒƒã‚¯

##### åœ¨åº«é€šçŸ¥
1. **åˆå›æ¤œå‡º**: åœ¨åº«ã‚ã‚Šã®å•†å“ã‚’ç™ºè¦‹ â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ â†’ å•†å“IDã‚’è¨˜éŒ²
2. **2å›ç›®ä»¥é™**: åŒã˜å•†å“ãŒåœ¨åº«ã‚ã‚Š â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã—ãªã„
3. **æ–°å•†å“å…¥è·**: æ–°ã—ã„å•†å“IDã‚’æ¤œå‡º â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
4. **å…¨ã¦å£²ã‚Šåˆ‡ã‚Œ**: å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ â†’ æ¬¡å›å†å…¥è·æ™‚ã«å†åº¦é€šçŸ¥

ã“ã®ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Šã€äºˆç´„å•†å“ãªã©é•·æœŸé–“åœ¨åº«ãŒã‚ã‚‹å•†å“ã«ã¤ã„ã¦ç¹°ã‚Šè¿”ã—é€šçŸ¥ã•ã‚Œã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚

##### å†è²©äºˆå®šé€šçŸ¥ï¼ˆupTimeæ¤œçŸ¥æ©Ÿèƒ½ï¼‰
1. **å†è²©äºˆå®šæ¤œçŸ¥**: `upTime`ãŒæœªæ¥ã®æ—¥æ™‚ã®å•†å“ã‚’ç™ºè¦‹ â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ â†’ å•†å“IDã‚’è¨˜éŒ²
2. **2å›ç›®ä»¥é™**: åŒã˜å•†å“ãŒå†è²©äºˆå®š â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã—ãªã„
3. **æ–°ãŸãªå†è²©äºˆå®š**: æ–°ã—ã„å•†å“IDã§å†è²©äºˆå®šã‚’æ¤œå‡º â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
4. **å†è²©é–‹å§‹**: `upTime`ãŒéå»ã«ãªã‚‹ã¨å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ â†’ åœ¨åº«é€šçŸ¥ã«åˆ‡ã‚Šæ›¿ãˆ

**ä¾‹**: "THE MONSTERS PIN FOR LOVE ã‚·ãƒªãƒ¼ã‚º" ãŒ 2025-10-23 15:00 ã«è²©å£²é–‹å§‹äºˆå®šã®å ´åˆã€äº‹å‰ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆ

ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œç¢ºèªï¼š

```bash
# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã—ï¼‰
DEBUG_MODE=true python check_stock.py

# ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ã‚’æŒ‡å®š
DEBUG_MODE=true KEYWORD=LABUBU python check_stock.py

# åœ¨åº«å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆ
rm stock_history.json

# å…¨å•†å“ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
python list_all_products.py

# ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿
python list_all_products.py --filter "LABUBU"

# å£²ã‚Šåˆ‡ã‚Œå•†å“ã‚‚å«ã‚ã¦å…¨ã¦è¡¨ç¤º
python list_all_products.py --show-all

# åˆ¥ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®š
python list_all_products.py --collection-id 241

# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
python list_all_products.py && python generate_html_report.py && open stock_report.html
```

**æ³¨æ„**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆã§ã¯ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯åœ¨åº«è¿½è·¡ã«ä½¿ç”¨ã•ã‚Œã‚‹ãŸã‚ã€`.gitignore` ã«è¿½åŠ æ¸ˆã¿ã§ã™ï¼š
- `stock_history.json` - åœ¨åº«å±¥æ­´
- `uptime_history.json` - å†è²©äºˆå®šå±¥æ­´ï¼ˆupTimeè¿½è·¡ï¼‰
- `all_products.json` - å…¨å•†å“ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰
- `stock_report.html` - è¦–è¦šçš„ãªHTMLãƒ¬ãƒãƒ¼ãƒˆ

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ãƒã‚§ãƒƒã‚¯é »åº¦ã‚’å¤‰æ›´

`.github/workflows/check-stock.yml` ã® `cron` è¨­å®šã‚’å¤‰æ›´ï¼š

```yaml
schedule:
  # ç¾åœ¨ã®è¨­å®šï¼ˆ5åˆ†ã”ã¨ï¼‰
  - cron: '*/5 * * * *'

  # 3æ™‚é–“ã”ã¨
  - cron: '0 */3 * * *'

  # æ¯æ—¥1å›ï¼ˆ0:00 UTC = 9:00 JSTï¼‰
  - cron: '0 0 * * *'
```

**æ³¨æ„**: é »ç¹ãªãƒã‚§ãƒƒã‚¯ã¯GitHub Actionsã®å®Ÿè¡Œæ™‚é–“ã‚’æ¶ˆè²»ã—ã¾ã™ã€‚publicãƒªãƒã‚¸ãƒˆãƒªã¯ç„¡åˆ¶é™ã§ã™ãŒã€APIã¸ã®è² è·ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚

### ä»–ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³IDã‚’ç¢ºèªï¼š
1. POP MARTã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. URLã‹ã‚‰æ•°å­—ã‚’ç¢ºèªï¼ˆä¾‹: `/collection/223`ï¼‰
3. `COLLECTION_ID` Secretã«è¨­å®š

## ä¿¡é ¼æ€§æ©Ÿèƒ½

### SMTPãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯

ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®ä¿¡é ¼æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã€è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ï¼š

- **æœ€å¤§3å›ã¾ã§è‡ªå‹•å†è©¦è¡Œ**: ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„SMTPæ¥ç¶šå•é¡Œã«å¯¾å¿œ
- **30ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: é•·æ™‚é–“ã®æ¥ç¶šå¾…ã¡ã‚’é˜²æ­¢
- **5ç§’ã®å¾…æ©Ÿæ™‚é–“**: å„ãƒªãƒˆãƒ©ã‚¤é–“éš”
- **è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›**: æˆåŠŸ/å¤±æ•—/ãƒªãƒˆãƒ©ã‚¤çŠ¶æ³ã‚’æ˜ç¢ºã«è¡¨ç¤º

#### å¯¾è±¡ã‚¨ãƒ©ãƒ¼

ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€è‡ªå‹•çš„ã«å†è©¦è¡Œã—ã¾ã™ï¼š
- `SMTPServerDisconnected`: SMTPæ¥ç¶šãŒäºˆæœŸã›ãšåˆ‡æ–­
- `SMTPConnectError`: SMTPæ¥ç¶šã‚¨ãƒ©ãƒ¼
- `TimeoutError`: æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

#### ãƒ­ã‚°ä¾‹

```
âš  SMTP connection error (attempt 1/3): Connection unexpectedly closed
  Retrying in 5 seconds...
âœ“ Email sent successfully to recipient@example.com
```

å…¨ã¦ã®è©¦è¡ŒãŒå¤±æ•—ã—ãŸå ´åˆã®ã¿ã€ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå¤±æ•—ã—ã¾ã™ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„

1. GitHub Actionsã®ãƒ­ã‚°ã‚’ç¢ºèª
2. SecretsãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. Gmailã®å ´åˆã€ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ç¢ºèª
4. ã‚¹ãƒ‘ãƒ ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª
5. **Gmail SMTPèªè¨¼ã‚¨ãƒ©ãƒ¼ï¼ˆ454ã‚¨ãƒ©ãƒ¼ï¼‰ãŒç™ºç”Ÿã™ã‚‹å ´åˆ**:
   - GitHub Actionsã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒGmailã«ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
   - `DEBUG_MODE` Secretã‚’ `true` ã«è¨­å®šã—ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ãƒ­ã‚°ã§åœ¨åº«çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™
   - åˆ¥ã®SMTPã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSendGridã€Mailgunç­‰ï¼‰ã®ä½¿ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„

### ä¸€æ™‚çš„ãªSMTPæ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Connection unexpectedly closed` ã‚¨ãƒ©ãƒ¼ãŒæ™‚ã€…ç™ºç”Ÿ

**åŸå› **: Gmail SMTPã‚µãƒ¼ãƒãƒ¼ã¾ãŸã¯GitHub Actionsã®ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œ

**å¯¾ç­–**: è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã‚Š3å›ã¾ã§å†è©¦è¡Œã•ã‚Œã¾ã™ã€‚ã»ã¨ã‚“ã©ã®ä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã«è§£æ±ºã•ã‚Œã¾ã™

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œãªã„

- ãƒªãƒã‚¸ãƒˆãƒªãŒé•·æœŸé–“æ›´æ–°ã•ã‚Œã¦ã„ãªã„å ´åˆã€GitHub ActionsãŒè‡ªå‹•çš„ã«ç„¡åŠ¹åŒ–ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™
- `Actions` ã‚¿ãƒ–ã‹ã‚‰æ‰‹å‹•ã§æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„

### åœ¨åº«ãŒã‚ã‚‹ã®ã«ãƒ¡ãƒ¼ãƒ«ãŒæ¥ãªã„ / å†è²©äºˆå®šãªã®ã«ãƒ¡ãƒ¼ãƒ«ãŒæ¥ãªã„

- `KEYWORD` Secretã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ä¸€è‡´ã—ãªã„å•†å“ã¯é€šçŸ¥ã•ã‚Œã¾ã›ã‚“
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ã‚’è§£é™¤ã™ã‚‹ã«ã¯ `KEYWORD` Secretã‚’å‰Šé™¤ã—ã¦ãã ã•ã„
- **æ—¢ã«é€šçŸ¥æ¸ˆã¿ã®å•†å“ã¯å†åº¦é€šçŸ¥ã•ã‚Œã¾ã›ã‚“**ã€‚ã“ã‚Œã¯é‡è¤‡é€šçŸ¥ã‚’é˜²ããŸã‚ã®ä»•æ§˜ã§ã™
- åœ¨åº«å±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ãŸã„å ´åˆã¯ã€GitHub Actionsã® `Actions` â†’ `Caches` ã‹ã‚‰ `stock-history-` ã§å§‹ã¾ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„
- upTimeå±¥æ­´ã‚‚åŒæ§˜ã« `stock-history-` ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å«ã¾ã‚Œã¾ã™

## APIä»•æ§˜

POP MARTã¯ä»¥ä¸‹ã®CDN APIã‚’ä½¿ç”¨ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰ï¼š

```
https://cdn-global.popmart.com/shop_productoncollection-{COLLECTION_ID}-1-{PAGE}-jp-ja.json
```

- `{COLLECTION_ID}`: ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³IDï¼ˆä¾‹: 223 = THE MONSTERS, 241 = Disneyï¼‰
- `{PAGE}`: ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆ1ã‹ã‚‰é–‹å§‹ã€404ãŒè¿”ã‚‹ã¾ã§è‡ªå‹•å–å¾—ï¼‰

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼š
```json
{
  "total": 101,
  "name": "THE MONSTERS",
  "productData": [
    {
      "id": "5737",
      "title": "å•†å“å",
      "skus": [
        {
          "price": 2255,
          "stock": {
            "onlineStock": 10
          },
          "currency": "JPY"
        }
      ]
    }
  ]
}
```

**åœ¨åº«åˆ¤å®š**: `skus[].stock.onlineStock > 0` ã®å ´åˆã€åœ¨åº«ã‚ã‚Šã¨åˆ¤å®šã—ã¾ã™ã€‚

## æŠ€è¡“è©³ç´°

### ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (email_utils.py)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯å …ç‰¢ãªãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`email_utils.py`) ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

#### ä½¿ç”¨æ–¹æ³•

```python
from email_utils import send_email_with_retry

success = send_email_with_retry(
    smtp_server='smtp.gmail.com',
    smtp_port=587,
    username='your@email.com',
    password='app_password',
    from_email='your@email.com',
    to_email='recipient@email.com',
    subject='ä»¶å',
    text_content='ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ',
    html_content='<html>HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„</html>',
    max_retries=3,
    retry_delay=5,
    timeout=30
)
```

#### ç‰¹å¾´

- è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3å›ï¼‰
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30ç§’ï¼‰
- è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›
- HTML/ãƒ†ã‚­ã‚¹ãƒˆä¸¡å¯¾å¿œ

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚å†åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

### å…¨å•†å“ãƒªã‚¹ãƒˆè¡¨ç¤ºãƒ„ãƒ¼ãƒ« (list_all_products.py)

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å…¨å•†å“ã¨åœ¨åº«çŠ¶æ³ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬çš„ãªä½¿ã„æ–¹ï¼ˆåœ¨åº«ã‚ã‚Šã®å•†å“ã®ã¿è¡¨ç¤ºï¼‰
python list_all_products.py

# å£²ã‚Šåˆ‡ã‚Œå•†å“ã‚‚å«ã‚ã¦å…¨ã¦è¡¨ç¤º
python list_all_products.py --show-all

# å•†å“åã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
python list_all_products.py --filter "PIN FOR LOVE"
python list_all_products.py --filter "LABUBU" --show-all

# åˆ¥ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®š
python list_all_products.py --collection-id 241
```

#### å‡ºåŠ›

- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«: åœ¨åº«çŠ¶æ³ã®ã‚µãƒãƒªãƒ¼ã¨å•†å“ãƒªã‚¹ãƒˆ
- `all_products.json`: å…¨å•†å“ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰

#### è¡¨ç¤ºå†…å®¹

- å•†å“ID
- å•†å“å
- åœ¨åº«çŠ¶æ³ï¼ˆSKUåˆ¥ï¼‰
- æ–°ç€/äººæ°—ãƒãƒƒã‚¸
- å•†å“URL

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ç‰¹å®šã®å•†å“ã®åœ¨åº«çŠ¶æ³ã‚’æ‰‹å‹•ã§ç¢ºèªã—ãŸã„å ´åˆã‚„ã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å…¨ä½“ã®å•†å“æ•°ã‚’æŠŠæ¡ã—ãŸã„å ´åˆã«ä¾¿åˆ©ã§ã™ã€‚

### HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ« (generate_html_report.py)

`all_products.json` ã‹ã‚‰è¦–è¦šçš„ãªHTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬çš„ãªä½¿ã„æ–¹
python generate_html_report.py

# ã‚«ã‚¹ã‚¿ãƒ å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
python generate_html_report.py --input all_products.json --output stock_report.html

# ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§å…¨ã¦å®Ÿè¡Œ
python list_all_products.py && python generate_html_report.py && open stock_report.html
```

#### ç‰¹å¾´

- **ç¾ã—ã„ãƒ‡ã‚¶ã‚¤ãƒ³**: ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ã¨ã‚«ãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- **çµ±è¨ˆã‚µãƒãƒªãƒ¼**: ç·å•†å“æ•°ã€åœ¨åº«ã‚ã‚Šã€å£²ã‚Šåˆ‡ã‚Œã®æ•°ã‚’ä¸€ç›®ã§ç¢ºèª
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½**: å…¨ã¦ / åœ¨åº«ã‚ã‚Š / å£²ã‚Šåˆ‡ã‚Œ / æ–°ç€ / äººæ°—
- **å•†å“ã‚«ãƒ¼ãƒ‰**:
  - ğŸ†• NEW ãƒãƒƒã‚¸ï¼ˆæ–°ç€å•†å“ï¼‰
  - ğŸ”¥ HOT ãƒãƒƒã‚¸ï¼ˆäººæ°—å•†å“ï¼‰
  - åœ¨åº«çŠ¶æ³ï¼ˆè‰²åˆ†ã‘ï¼šç·‘=åœ¨åº«ã‚ã‚Šã€èµ¤=å£²ã‚Šåˆ‡ã‚Œï¼‰
  - å•†å“ãƒšãƒ¼ã‚¸ã¸ã®ç›´ãƒªãƒ³ã‚¯
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**: ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã‚‚è¦‹ã‚„ã™ã„

#### å‡ºåŠ›ä¾‹

HTMLãƒ¬ãƒãƒ¼ãƒˆã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã¿ã¾ã™ï¼š
- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åã¨ID
- æ›´æ–°æ—¥æ™‚ï¼ˆJSTï¼‰
- åœ¨åº«çŠ¶æ³ã®çµ±è¨ˆ
- å…¨å•†å“ã®è©³ç´°ï¼ˆãƒ•ã‚£ãƒ«ã‚¿å¯èƒ½ï¼‰

ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ã€è¦–è¦šçš„ã«å…¨å•†å“ã®åœ¨åº«çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚

### åœ¨åº«å¤‰å‹•æ¤œçŸ¥ã®ä»•çµ„ã¿

#### åœ¨åº«å±¥æ­´ï¼ˆstock_history.jsonï¼‰
åœ¨åº«å±¥æ­´ã¯ `stock_history.json` ã«ä¿å­˜ã•ã‚Œã€GitHub Actions Cacheã§å®Ÿè¡Œé–“ã§æ°¸ç¶šåŒ–ã•ã‚Œã¾ã™ï¼š

```json
{
  "product_ids": ["5737", "4110", ...],
  "timestamp": "2025-10-07T13:42:15.123456"
}
```

- å‰å›ãƒã‚§ãƒƒã‚¯æ™‚ã«åœ¨åº«ãŒã‚ã£ãŸå•†å“IDã®ãƒªã‚¹ãƒˆã‚’è¨˜éŒ²
- æ–°ã—ã„ãƒã‚§ãƒƒã‚¯ã§æ¤œå‡ºã•ã‚ŒãŸå•†å“IDã¨æ¯”è¼ƒ
- å·®åˆ†ï¼ˆæ–°è¦ã«åœ¨åº«ãŒè¿½åŠ ã•ã‚ŒãŸå•†å“ï¼‰ã®ã¿ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- å…¨å•†å“ãŒåœ¨åº«åˆ‡ã‚Œã®å ´åˆã¯å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ï¼ˆå†å…¥è·æ™‚ã«é€šçŸ¥ã™ã‚‹ãŸã‚ï¼‰

#### upTimeå±¥æ­´ï¼ˆuptime_history.jsonï¼‰
å†è²©äºˆå®šå•†å“ã®å±¥æ­´ã¯ `uptime_history.json` ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼š

```json
{
  "product_ids": ["6935", "6936", ...],
  "timestamp": "2025-10-22T16:50:15.123456"
}
```

- å‰å›ãƒã‚§ãƒƒã‚¯æ™‚ã«å†è²©äºˆå®šã ã£ãŸå•†å“IDã®ãƒªã‚¹ãƒˆã‚’è¨˜éŒ²
- æ–°ã—ã„ãƒã‚§ãƒƒã‚¯ã§æ¤œå‡ºã•ã‚ŒãŸå•†å“IDã¨æ¯”è¼ƒ
- å·®åˆ†ï¼ˆæ–°è¦ã«å†è²©äºˆå®šãŒè¿½åŠ ã•ã‚ŒãŸå•†å“ï¼‰ã®ã¿ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- å†è²©äºˆå®šãŒãªããªã£ãŸå ´åˆã¯å±¥æ­´ã‚’ã‚¯ãƒªã‚¢

**upTimeã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯**:
- `upTime > ç¾åœ¨æ™‚åˆ»`: è²©å£²é–‹å§‹å‰ï¼ˆäºˆç´„å¯èƒ½ï¼‰ â†’ "ã‚«ãƒ¼ãƒˆã«å…¥ã‚Œã‚‹"
- `upTime < ç¾åœ¨æ™‚åˆ»` ã‹ã¤ `onlineStock > 0`: è²©å£²ä¸­ï¼ˆåœ¨åº«ã‚ã‚Šï¼‰ â†’ "ã‚«ãƒ¼ãƒˆã«å…¥ã‚Œã‚‹"
- `upTime < ç¾åœ¨æ™‚åˆ»` ã‹ã¤ `onlineStock = 0`: å£²ã‚Šåˆ‡ã‚Œ â†’ "å†å…¥è·ã‚’é€šçŸ¥"

### GitHub Actions Cache

- ã‚­ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³: `stock-history-{run_id}`
- ãƒªã‚¹ãƒˆã‚¢ã‚­ãƒ¼: `stock-history-` ï¼ˆæœ€æ–°ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è‡ªå‹•å–å¾—ï¼‰
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯7æ—¥é–“ä¿æŒã•ã‚Œã¾ã™ï¼ˆGitHub Actionsä»•æ§˜ï¼‰

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## æ³¨æ„äº‹é …

- APIã®éåº¦ãªä½¿ç”¨ã¯é¿ã‘ã¦ãã ã•ã„
- ãƒã‚§ãƒƒã‚¯é »åº¦ã¯é©åˆ‡ã«è¨­å®šã—ã¦ãã ã•ã„
